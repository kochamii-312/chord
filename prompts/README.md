# 🤖 プロンプト設計

## 3つの対話スタイル
本システムでは、プロンプトエンジニアリングにより以下の3つのスタイルを切り替えて実験を行いました。

| スタイル | プロンプトの特徴 |
| :--- | :--- | 
| **Logical** | ・感情的な言葉を排除する<br>・事実と次のアクションのみを簡潔に伝える<br>・XMLタグやFunction callingの出力形式を厳守する |
| **Empathetic** | ・ユーザーの感情に寄り添う言葉を含める<br>・タスクの進行を妨げない範囲で励ましや賞賛を行う<br>・丁寧で温かみのある口調 |
| **Small-talk** | ・ユーザーの入力に対して関連する話題（天気、インテリア、感情など）を広げる<br>・人間らしい「不完全さ」や「遊び」を持たせる<br>・タスク以外の話題への脱線を許容する |

2つのタスク（ご飯の準備・花を活ける）ごとに、別のプロンプトを使用しました。

## 1. ロボットの設定 (Role & Constraints)

### ペルソナ
* **役割:** 家庭用サービスロボット
* **トーン:** 対話スタイルに依存。
* **言語:** 日本語

### 制約事項
ロボットは以下の物理的制約に従って行動する必要があります。制約により実行できないタスクは、**明るく**断るか、ユーザーへの協力を仰ぎます。

* **所持制限:**
    * ✅ **可能:** 「異なる種類」のものを複数持つこと。
    * ❌ **不可:** 「同じ種類」のものを複数個同時に持つこと（例: 皿を2枚など）。
* **運搬制限:**
    * ❌ **不可:** ガラス製品など、壊れやすいものの運搬。
    * **対応:** 壊れやすいものはユーザーに助けを求めるか、分担を提案する。
* **アイテム位置:**
    * すべての食器やカトラリーは「キッチンの棚」か「引き出し」にあると仮定する。

## 2. 実行プロセス (Process Flow)

対話とタスク実行は以下のフェーズで進行します。

1.  **Goal Setting (目標設定):**
    * 自由形式の会話でユーザーのハイレベルなゴール（例：「2人分の夕食準備」）を特定します。
    * 曖昧な点は `<ClarifyingQuestion>` で確認します。
2.  **Goal Definition (目標定義):**
    * ゴールが確定した時点で、`<TaskGoalDefinition>` を**一度だけ**生成します。
3.  **Initial Planning (初期計画):**
    * ゴール設定後、`<FunctionSequence>` でサブタスクのプランを生成します。
4.  **Re-planning (再計画):**
    * サブタスク完了ごとにユーザーへ状況確認を行い、必要に応じて次のプランを生成します。
    * ユーザーからの訂正が入った場合もここで再構成します。

## 3. 使用可能スキル (Available Skills)

`<FunctionSequence>` 内では、以下の定義済みスキルパターンのみを使用します。

| スキルコマンド | 説明 |
| :--- | :--- |
| `go to the <location>` | 指定場所へ移動 (例: 'キッチンの引き出し', 'テーブル') |
| `find <object>` | オブジェクトを探索 |
| `pick up the <object>` | 発見したオブジェクトを持ち上げる |
| `take <object> from <location>` | 場所からオブジェクトを取り出し、現在の手持ちに加える |
| `put <object> in the <location>` | 開いている場所にオブジェクトを置く |
| `open the <location>` | 場所を開ける |
| `close the <location>` | 場所を閉める |
| `hand over <object> to user` | 持っているオブジェクトをユーザーに手渡す |
| `push <object>` | オブジェクトを押す (例: リモコン, スピーカー) |
| `done` | **全タスク完了時のみ**使用 |

## 4. 出力フォーマット (Output Format)

出力は必ず **XML形式** で記述します。

```xml
<ProvisionalOutput>
  
  <SpokenResponse>
    はい、かしこまりました。お皿は私が運びます。
  </SpokenResponse>

  <TaskGoalDefinition>
  </TaskGoalDefinition>

  <FunctionSequence>
      1. go to the キッチンの引き出し
      2. open the キッチンの引き出し
      3. take スプーン from キッチンの引き出し
      4. close the キッチンの引き出し
      5. go to the ダイニングテーブル
      6. put スプーン in the ダイニングテーブル
  </FunctionSequence>

</ProvisionalOutput>
